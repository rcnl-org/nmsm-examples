<?xml version="1.0" encoding="UTF-8" ?>
<NMSMPipelineDocument Version="0.1.0">
    <TrackingOptimizationTool>
        <!--Directory used for writing results.-->
        <results_directory>SynergyDrivenTO</results_directory>
        <!--Directory for input files-->
        <data_directory>preprocessed</data_directory>
        <!--Name of the input model file (.osim) to use-->
        <input_model_file>simple_arm_muscles.osim</input_model_file>
    	<!--*Optional* Name of the initial states guess file-->
    	<initial_states_file></initial_states_file>
    	<!--*Optional* Name of the initial controls guess file-->
    	<initial_controls_file></initial_controls_file>
    	<!--*Optional* Name of the initial parameters guess file-->
    	<initial_parameters_file></initial_parameters_file>
    	<!--Indicate the name of the type of controller: synergy driven or torque driven-->
    	<type_of_controller>synergy_driven</type_of_controller>
    	<!--Indicate if synergy vectors should be optimized-->
    	<optimize_synergy_vectors>false</optimize_synergy_vectors>
    	<!--Name of the osimx model file-->
    	<osimx_file>results/simple_arm_muscles_ncp.osimx</osimx_file>
    	<!--Indicate the surrogate model coordinates-->
    	<coordinate_list>r_elbow_flex</coordinate_list>
    	<!--Name of the surrogate model coefficients file-->
    	<surrogate_model_coefficients>coefficients.mat</surrogate_model_coefficients>
		<!--Name of optimal controls setting file-->
		<optimal_control_settings_file>gpopsSettings.xml</optimal_control_settings_file>
    	<!--Indicate synergy group names-->
    	<SynergySet>
    		<objects>
    			<Synergy>
    				<muscle_group_name>triceps</muscle_group_name>
    				<num_synergies>1</num_synergies>
    			</Synergy>
    			<Synergy>
    				<muscle_group_name>biceps</muscle_group_name>
    				<num_synergies>1</num_synergies>
    			</Synergy>
    		</objects>
    		<groups />
    	</SynergySet>
    	<!--Design variable bounds-->
    	<RCNLDesignVariableBoundsTerms>
    		<joint_positions_multiple>2</joint_positions_multiple>
    		<joint_velocities_multiple>1.5</joint_velocities_multiple>
    		<joint_accelerations_multiple>1</joint_accelerations_multiple>
    		<joint_jerks_multiple>1</joint_jerks_multiple>
    		<synergy_activations_max>10</synergy_activations_max>
    		<synergy_weights_max>0.15</synergy_weights_max>
    	</RCNLDesignVariableBoundsTerms>
		<RCNLCostTermSet>
			<RCNLCostTerm>
				<type>coordinate_tracking</type>
				<coordinate>r_elbow_flex</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.1</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>inverse_dynamics_load_tracking</type>
				<load>r_elbow_flex_moment</load>
				<is_enabled>true</is_enabled>
				<max_allowable_error>20</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>muscle_activation_tracking</type>
				<muscle>TRIlat</muscle>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.25</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>muscle_activation_tracking</type>
				<muscle>TRImed</muscle>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.25</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>muscle_activation_tracking</type>
				<muscle>BRA</muscle>
				<is_enabled>true</is_enabled>
				<max_allowable_error>0.06</max_allowable_error>
			</RCNLCostTerm>
			<RCNLCostTerm>
				<type>joint_jerk_minimization</type>
				<coordinate>r_elbow_flex</coordinate>
				<is_enabled>true</is_enabled>
				<max_allowable_error>2</max_allowable_error>
			</RCNLCostTerm>
		</RCNLCostTermSet>
		<RCNLPathConstraintTerms>
			<RCNLConstraintTermSet>
				<objects>
					<RCNLConstraintTerm>
						<type>muscle_model_moment_consistency</type>
						<load>r_elbow_flex_moment</load>
						<is_enabled>true</is_enabled>
						<max_error>0.2</max_error>
						<min_error>-0.2</min_error>
					</RCNLConstraintTerm>
				</objects>
				<groups />
			</RCNLConstraintTermSet>
		</RCNLPathConstraintTerms>
		<RCNLTerminalConstraintTerms>
			<RCNLConstraintTermSet>
				<objects>
					<RCNLConstraintTerm>
						<type>synergy_weight_sum</type>
						<synergy_group>triceps</synergy_group>
						<is_enabled>true</is_enabled>
						<max_error>1</max_error>
						<min_error>1</min_error>
					</RCNLConstraintTerm>
					<RCNLConstraintTerm>
						<type>synergy_weight_sum</type>
						<synergy_group>biceps</synergy_group>
						<is_enabled>true</is_enabled>
						<max_error>1</max_error>
						<min_error>1</min_error>
					</RCNLConstraintTerm>
				</objects>
				<groups />
			</RCNLConstraintTermSet>
		</RCNLTerminalConstraintTerms>
		<!--Epsilon-->
		<epsilon>1e-4</epsilon>
  		<!--*Optional* The vMaxFactor to use-->
        <v_max_factor>10</v_max_factor>
		<!--*Optional* list prefix of the data file, if left blank, use prefix from IK folder-->
		<trial_prefix></trial_prefix>
    </TrackingOptimizationTool>
</NMSMPipelineDocument>
